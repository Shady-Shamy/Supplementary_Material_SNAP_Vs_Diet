{
  "hash": "cb295aabb0351c2253107fb353c2851a",
  "result": {
    "markdown": "---\ntitle: \"Imputations\"\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\n---\n\n\n> This page shows all steps taken for the imputation process. Imputations were conducted using the MICE R package using an M of 5 and 30 maximum iterations. All potential covariates were included in the imputations. Variables used to create derived variables were not included in the imputations due to too much collinearity with the derived variable causing convergence not to be reached. Some data management was performed to dichotomize variables, change reference values, and create variables used for testing different model types. Models using imputed data were compared to models using non-imputed data.\n\n::: panel-tabset\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(error = FALSE,warning = FALSE,message = FALSE,echo = TRUE)\n\n\nlibrary(mice)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'mice'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:stats':\n\n    filter\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    cbind, rbind\n```\n:::\n\n```{.r .cell-code}\nlibrary(forestplot)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: grid\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: checkmate\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: abind\n```\n:::\n\n```{.r .cell-code}\nlibrary(dotwhisker)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: ggplot2\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(gtsummary)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nload(here::here(\"clean_data/bns_combined.Rdata\"))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Due to the lengthy imputation process, the imputed data was saved and the code was commented out\n # imp_bns_combined_raw_mids <- mice(variables_of_interest, m=5, maxit=30, seed=500, printFlag=TRUE, method = vector.methods)\n\n# saveRDS(imp_bns_combined_raw_mids, file =\"clean_data/imp_bns_combined_raw_mids.RData\")\n\nimp_bns_combined_raw_mids <- readRDS(here::here(\"clean_data/imp_bns_combined_raw_mids.RData\"))\n```\n:::\n\n\n# Data Management\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#  Create a Complete Data Set\nimp_bns_combined_long <- complete(imp_bns_combined_raw_mids, action= \"long\", include = TRUE)\n\n\n# Create temporary SNAP variable\nimp_bns_combined_long <- imp_bns_combined_long %>% mutate(current_SNAP_temp = \n                        case_when(grepl(\"Currently use as a college student\", q46_1) ~ \"SNAP\",\n                                                          grepl(\"Used it in the past as a college student\", q46_1) ~ \"No SNAP\",\n                                                          grepl(\"Heard of it, but never used it\", q46_1) ~ \"No SNAP\",\n                                                          grepl(\"Never heard of it\", q46_1) ~ \"No SNAP\",\n                                                          grepl(\"Used it before attending college\", q46_1) ~ \"No SNAP\"))\n# table(imp_bns_combined_long$q46_1, imp_bns_combined_long$current_SNAP_temp, useNA = \"always\")\n\n\nimp_bns_combined_long$SNAP3 <- case_when(imp_bns_combined_long$current_SNAP_temp == \"SNAP\" ~ \"SNAP Recipient\", \n                               imp_bns_combined_long$current_SNAP_temp == \"No SNAP\" & \n                                 imp_bns_combined_long$SNAP_eligible == \"Yes\" ~ \"Likely Eligible Non-Recipient\",\n                               imp_bns_combined_long$current_SNAP_temp == \"No SNAP\" & \n                                 imp_bns_combined_long$SNAP_eligible == \"No\" ~ \"Income-Ineligible Non-Recipient\") \n\n\nimp_bns_combined_long$SNAP3 <- factor(imp_bns_combined_long$SNAP3, \n                                      levels = c(\"SNAP Recipient\", \"Likely Eligible Non-Recipient\", \"Income-Ineligible Non-Recipient\"))\n\n#  imp_bns_combined_long %>% select(SNAP3, current_SNAP_temp, SNAP_eligible) %>% unique()\n\n\n\n# Change reference values\n\nimp_bns_combined_long$health_conscious <- factor(imp_bns_combined_long$health_conscious, order = FALSE) %>% relevel(imp_bns_combined_long$health_conscious, ref = \"No\")\n\nimp_bns_combined_long$kitchen_access <- factor(imp_bns_combined_long$kitchen_access, order = FALSE) %>% relevel(imp_bns_combined_long$kitchen_access, ref = \"No\")\n\nimp_bns_combined_long$storage_room <- factor(imp_bns_combined_long$storage_room, order = FALSE) %>% relevel(imp_bns_combined_long$storage_room, ref = \"No\")\n\n\n# Create variables for stratified logistic regressions (Used to test different models)\n\n\n## FV ------------------------\nimp_bns_combined_long$q77_one_vs_zero <- case_when(imp_bns_combined_long$fruits3 == \"0\" ~ \"0\", imp_bns_combined_long$fruits3 == \"1-2\" ~ \"1-2\")  %>% factor(order = FALSE)\n\nimp_bns_combined_long$q77_one_vs_three_or_more <- case_when(imp_bns_combined_long$fruits3 == \"3 or more\" ~ \"3 or more\", imp_bns_combined_long$fruits3 == \"1-2\" ~ \"1-2\")  %>% factor(order = FALSE)\n\n## SSB -------------------------------\n\n\nimp_bns_combined_long$ssb_cat1 <- case_when(imp_bns_combined_long$ssb_cat == \"Zero\" ~ \"Zero\",\n                                      imp_bns_combined_long$ssb_cat == \"1-8 ounces\" ~ \"1-8 ounces\") %>% factor(order = FALSE) %>% relevel(ref = \"Zero\")\n\nimp_bns_combined_long$ssb_cat2 <- case_when(imp_bns_combined_long$ssb_cat == \"1-8 ounces\" ~ \"1-8 ounces\", imp_bns_combined_long$ssb_cat == \"9-16 ounces\" ~ \"9-16 ounces\") %>% factor(order = FALSE)\n\nimp_bns_combined_long$ssb_cat3 <- case_when(imp_bns_combined_long$ssb_cat == \"9-16 ounces\" ~ \"9-16 ounces\",\n                                  imp_bns_combined_long$ssb_cat == \"17 or more ounces\" ~ \"17 or more ounces\") %>% factor(order = FALSE) %>% relevel(ref = \"9-16 ounces\")\n\n\n## FF ------------------------------------\n\nimp_bns_combined_long$ff_cat1 <- case_when(imp_bns_combined_long$ff_cat == \"Zero\" ~ \"Zero\", imp_bns_combined_long$ff_cat == \"1-2 times per week\" ~ \"1-2 times per week\") %>% factor(order = FALSE) %>% relevel(ref = \"Zero\")\n\nimp_bns_combined_long$ff_cat2 <- case_when(imp_bns_combined_long$ff_cat == \"1-2 times per week\" ~ \"1-2 times per week\", imp_bns_combined_long$ff_cat == \"3-4 times per week\" ~ \"3-4 times per week\") %>% factor(order = FALSE)\n\nimp_bns_combined_long$ff_cat3 <- case_when(imp_bns_combined_long$ff_cat == \"3-4 times per week\" ~ \"3-4 times per week\",\n                                  imp_bns_combined_long$ff_cat == \"5 or more times per week\" ~ \"5 or more times per week\") %>% factor(order = FALSE)\n\n\n\n# Change numeric variables to increments\n\nimp_bns_combined_long$paid_work_hours_tens <- (imp_bns_combined_long$paid_work_hours)/10\nimp_bns_combined_long$unpaid_work_hours_tens <- (imp_bns_combined_long$unpaid_work_hours)/10\nimp_bns_combined_long$caregiving_hours_tens <- (imp_bns_combined_long$caregiving_hours)/10\nimp_bns_combined_long$units_four <- (imp_bns_combined_long$units)/4\nimp_bns_combined_long$age_five <- (imp_bns_combined_long$age)/5\n\n\n# Change Reference\nimp_bns_combined_long$food_insecure_2item <- factor(imp_bns_combined_long$food_insecure_2item, order = FALSE) %>% relevel(imp_bns_combined_long$food_insecure_2item, ref = \"No\")\n\n\n# Create numeric variables for LASSO regressions and testing a linear model\n\nimp_bns_combined_long$ff_numeric <- recode(imp_bns_combined_long$ff_cat, \n                                             \"Zero\" = 0, \"1-2 times per week\" = 1,\n                                             \"3-4 times per week\" = 3,\n                                             \"5 or more times per week\" = 5)\n\n\nimp_bns_combined_long$ssb_numeric <- recode(imp_bns_combined_long$ssb_cat,\n                                              \"Zero\" = 0, \"1-8 ounces\" = 1,\n                                              \"9-16 ounces\" = 9, \"17 or more ounces\" = 17)\n\nimp_bns_combined_long$q77_numeric <- recode(imp_bns_combined_long$fruits3, \"0\" = 0,\n                                              \"1-2\" = 1, \"3 or more\" = 3)\n\n\n\n# Rename q7 to gender\nimp_bns_combined_long <- rename(imp_bns_combined_long, gender = q7)\n\n# Set firstgen as factor, recode to Yes/No and change reference\nimp_bns_combined_long$firstgen <- recode(imp_bns_combined_long$firstgen, \"1\" = \"Yes\", \"0\" = \"No\") %>%\n  factor(order = FALSE) %>% relevel(ref = \"No\")\n\n# Set homeless_year as factor, recode to Yes/No and change reference\nimp_bns_combined_long$homelessness_year <- recode(imp_bns_combined_long$homelessness_year, \"1\" = \"Yes\", \"0\" = \"No\") %>%\n  factor(order = FALSE) %>% relevel(ref = \"No\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert back to Mids\n# imp_bns_combined_clean_mids <- as.mids(imp_bns_combined_long, .imp = \".imp\")\n# \n# saveRDS(imp_bns_combined_clean_mids, file = \"clean_data/imp_bns_combined_clean_mids.RData\")\n\n\nimp_bns_combined_clean_mids <- readRDS(here::here(\"clean_data/imp_bns_combined_clean_mids.RData\"))\n```\n:::\n\n\n# Check Convergence\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check convergence of all variables.\nplot(imp_bns_combined_raw_mids, c(\"q46_1\", \"fruits3\", \"ff_cat\", \"ssb_cat\", \"race_eth\", \"eth_hispanic\", \"food_insecure_2item\", \"cooking_confident\", \"living_with_family\", \"health_conscious\", \"storage_access\", \"storage_room\", \"kitchen_access\", \"household_size\", \"physical_activity\", \"SNAP_eligible\", \"firstgen\", \"academic_level\", \"housing_insecure\", \"homelessness_year\", \"q7\",\n                                  \"paid_work_hours\", \"unpaid_work_hours\", \"units\", \"caregiving_hours\", \"school\"))\n```\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-7-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-7-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-7-5.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-7-6.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-7-7.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-7-8.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-7-9.png){width=672}\n:::\n:::\n\n\n# Compare Non-Imputed and Imputed Models\n\n## Compare SSB Non-Imputed and Imputed Models\n\n\n::: {.cell}\n\n```{.r .cell-code}\noriginal_ssb_model <- MASS::polr(ssb_cat~SNAP3 + Cohort + race_eth + gender + age + units_four + unpaid_work_hours_tens + paid_work_hours_tens + caregiving_hours_tens + health_conscious + storage_access + physical_activity + homelessness_year, data = bns_combined, Hess=TRUE)\n\n\n\nimp_ssb_model <- with(imp_bns_combined_clean_mids, MASS::polr(ssb_cat~SNAP3 + Cohort + race_eth + gender + age + units_four + unpaid_work_hours_tens + paid_work_hours_tens + caregiving_hours_tens + health_conscious + storage_access + physical_activity + homelessness_year, Hess=TRUE))\n# pool(imp_ssb_model) |> summary()\n\noriginal_ssb_model_tidy <- tidy(original_ssb_model) %>%\n  mutate(model = \"original_ssb_model\")\n\nimp_ssb_model_tidy <- pool(imp_ssb_model) |> summary() %>%\n  mutate(model = \"imp_ssb_model\") %>% select(-df)\n\nssb_models <- bind_rows(original_ssb_model_tidy , imp_ssb_model_tidy)\n\ndwplot(ssb_models) + geom_vline(xintercept = 0,\n               colour = \"black\",\n               linetype = 1)\n```\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## Compare Fast Food Non-imputed and Imputed Models\n\n\n::: {.cell}\n\n```{.r .cell-code}\noriginal_ff_model <- MASS::polr(ff_cat~SNAP3 + Cohort + gender + race_eth + age + physical_activity + storage_room + kitchen_access + health_conscious + living_with_family + cooking_confident + food_insecure_2item + paid_work_hours_tens + homelessness_year, data = bns_combined, Hess=TRUE)\n\n\nimp_ff_model <- with(imp_bns_combined_clean_mids, MASS::polr(ff_cat~SNAP3 + Cohort + gender + race_eth + age + physical_activity + storage_room + kitchen_access + health_conscious + living_with_family + cooking_confident + food_insecure_2item + paid_work_hours_tens + homelessness_year, Hess=TRUE))\n# pool(imp_ff_model) |> summary()\n\n\noriginal_ff_model_tidy <- tidy(original_ff_model) %>%\n  mutate(model = \"original_ff_model\")\n\nimp_ff_model_tidy <- pool(imp_ff_model) |> summary() %>%\n  mutate(model = \"imp_ff_model\") %>% select(-df)\n\nff_models <- bind_rows(original_ff_model_tidy , imp_ff_model_tidy)\n\ndwplot(ff_models) + geom_vline(xintercept = 0,\n               colour = \"black\",\n               linetype = 1)\n```\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## Compare F&V Non-Imputed and Imputed Models\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimp_FV_model <- with(imp_bns_combined_clean_mids, MASS::polr(fruits3~SNAP3 + Cohort + gender + race_eth + age  + health_conscious + cooking_confident + physical_activity + storage_room + food_insecure_2item + firstgen, Hess=TRUE))\n\n\noriginal_FV_model <- MASS::polr(fruits3~SNAP3 + Cohort + gender + race_eth + age  + health_conscious + cooking_confident + physical_activity + storage_room + food_insecure_2item + firstgen, data = bns_combined, Hess=TRUE)\n\noriginal_FV_model_tidy <- tidy(original_FV_model) %>%\n  mutate(model = \"original_FV_model\")\n\nimp_FV_model_tidy <- pool(imp_FV_model) |> summary() %>%\n  mutate(model = \"imp_FV_model\") %>% select(-df)\n\nFV_models <- bind_rows(original_FV_model_tidy , imp_FV_model_tidy)\n\ndwplot(FV_models)  + geom_vline(xintercept = 0,\n               colour = \"black\",\n               linetype = 1)\n```\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n:::\n",
    "supporting": [
      "Imputations_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}