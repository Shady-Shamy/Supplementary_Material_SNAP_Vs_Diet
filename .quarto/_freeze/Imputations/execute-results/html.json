{
  "hash": "e8cb1d988a3f59e2307d043a3bad5c2d",
  "result": {
    "markdown": "---\ntitle: \"Imputations\"\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\n---\n\n\n> This page shows all steps taken for the imputation process. Imputations were conducted using the MICE R package using an M of 5 and 30 maximum iterations. All potential covariates were included in the imputation process as well as variables used to create the derived variables. Some of the variables that were used to create the dependent variables were removed due to too much collinearity with the derived variable and issues with reaching convergence. Some data management was performed to dichotomize variables, change reference values, and create variables used for testing different models. Models using imputed data were compared to models using complete case data.\n\n::: panel-tabset\n# Impute Values\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbns_combined <- bns_combined %>% mutate_at(c(\"eth_hispanic\", \"firstgen\", \"housing_insecure\", \"homelessness_year\"), as.factor)\n\nvariables_of_interest <- bns_combined %>% select(calfresh3, race_eth, eth_hispanic, q7, age, cooking_confident, living_with_family, food_insecure_2item, health_conscious, storage_access, storage_room, kitchen_access, ff_cat, ssb_cat, fruits3, household_size, monthly_hh_income, paid_work_hours, unpaid_work_hours, units, caregiving_hours, q64, q65, school, physical_activity, q83_1, q83_2, q83_3, calfresh_eligible, firstgen, academic_level, housing_insecure, homelessness_year)\n\n\nvector.methods <- c(\"polyreg\", \"polyreg\", \"logreg\", \"logreg\", \"pmm\", \"logreg\", \"logreg\", \"logreg\",\n                    \"logreg\", \"logreg\", \"logreg\", \"logreg\", \"polyreg\", \"polyreg\", \"polyreg\",\n                    \"pmm\", \"polyreg\", \"pmm\", \"pmm\", \"pmm\", \"pmm\",\n                    \"polyreg\", \"polyreg\", \"polyreg\", \"logreg\", \"pmm\", \"pmm\", \"pmm\",\n                    \"logreg\", \"logreg\", \"polyreg\", \"logreg\", \"logreg\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Due to the lengthy imputation process, the imputed data was saved and the code was commented out\n#  imp_bns_combined_raw_mids <- mice(variables_of_interest, m=5, maxit=35, seed=500, printFlag=TRUE, method = vector.methods)\n\n# saveRDS(imp_bns_combined_raw_mids, file = \"imp_bns_combined_raw_mids.RData\")\n\n\nimp_bns_combined_raw_mids <- readRDS(\"clean_data/imp_bns_combined_raw_mids.RData\")\n```\n:::\n\n\n## Check Imputation methods\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimp_bns_combined_raw_mids$meth\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          calfresh3            race_eth        eth_hispanic                  q7 \n          \"polyreg\"           \"polyreg\"            \"logreg\"            \"logreg\" \n                age   cooking_confident  living_with_family food_insecure_2item \n                 \"\"            \"logreg\"            \"logreg\"            \"logreg\" \n   health_conscious      storage_access        storage_room      kitchen_access \n           \"logreg\"            \"logreg\"            \"logreg\"            \"logreg\" \n             ff_cat             ssb_cat             fruits3      household_size \n          \"polyreg\"           \"polyreg\"           \"polyreg\"               \"pmm\" \n  monthly_hh_income     paid_work_hours   unpaid_work_hours               units \n          \"polyreg\"               \"pmm\"               \"pmm\"               \"pmm\" \n   caregiving_hours                 q64                 q65              school \n              \"pmm\"           \"polyreg\"           \"polyreg\"           \"polyreg\" \n  physical_activity               q83_1               q83_2               q83_3 \n           \"logreg\"               \"pmm\"               \"pmm\"               \"pmm\" \n  calfresh_eligible            firstgen      academic_level    housing_insecure \n           \"logreg\"            \"logreg\"           \"polyreg\"            \"logreg\" \n  homelessness_year \n           \"logreg\" \n```\n:::\n:::\n\n\n## Check Convergence\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check convergence of a few variables. Note: all imputed variables were checked but only a few are displayed \nplot(imp_bns_combined_raw_mids, c(\"calfresh3\", \"calfresh_eligible\", \"fruits3\", \"ff_cat\", \"ssb_cat\"))\n```\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::\n\n\n# Imputation data management\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#  Create a Complete Data Set\nimp_bns_combined_long <- complete(imp_bns_combined_raw_mids, action= \"long\", include = TRUE)\n\n\n# Gender: Rename -----\n\nimp_bns_combined_long <- rename(imp_bns_combined_long, gender = q7)\n\n# Change reference values\n\nimp_bns_combined_long$health_conscious <- factor(imp_bns_combined_long$health_conscious, order = FALSE) %>% relevel(imp_bns_combined_long$health_conscious, ref = \"No\")\n\nimp_bns_combined_long$kitchen_access <- factor(imp_bns_combined_long$kitchen_access, order = FALSE) %>% relevel(imp_bns_combined_long$kitchen_access, ref = \"No\")\n\nimp_bns_combined_long$storage_room <- factor(imp_bns_combined_long$storage_room, order = FALSE) %>% relevel(imp_bns_combined_long$storage_room, ref = \"No\")\n\n\n# Create variables to check ordinal regression\n\n\n## FV ------------------------\nimp_bns_combined_long$q77_one_vs_zero <- case_when(imp_bns_combined_long$fruits3 == \"0\" ~ \"0\", imp_bns_combined_long$fruits3 == \"1-2\" ~ \"1-2\")  %>% factor(order = FALSE)\n\nimp_bns_combined_long$q77_one_vs_three_or_more <- case_when(imp_bns_combined_long$fruits3 == \"3 or more\" ~ \"3 or more\", imp_bns_combined_long$fruits3 == \"1-2\" ~ \"1-2\")  %>% factor(order = FALSE)\n\n## SSB -------------------------------\n\n\nimp_bns_combined_long$ssb_cat1 <- case_when(imp_bns_combined_long$ssb_cat == \"Zero\" ~ \"Zero\",\n                                      imp_bns_combined_long$ssb_cat == \"1-8 ounces\" ~ \"1-8 ounces\") %>% factor(order = FALSE) %>% relevel(ref = \"Zero\")\n\nimp_bns_combined_long$ssb_cat2 <- case_when(imp_bns_combined_long$ssb_cat == \"1-8 ounces\" ~ \"1-8 ounces\", imp_bns_combined_long$ssb_cat == \"9-16 ounces\" ~ \"9-16 ounces\") %>% factor(order = FALSE)\n\nimp_bns_combined_long$ssb_cat3 <- case_when(imp_bns_combined_long$ssb_cat == \"9-16 ounces\" ~ \"9-16 ounces\",\n                                  imp_bns_combined_long$ssb_cat == \"17 or more ounces\" ~ \"17 or more ounces\") %>% factor(order = FALSE) %>% relevel(ref = \"9-16 ounces\")\n\n\n## FF ------------------------------------\n\nimp_bns_combined_long$ff_cat1 <- case_when(imp_bns_combined_long$ff_cat == \"Zero\" ~ \"Zero\", imp_bns_combined_long$ff_cat == \"1-2 times per week\" ~ \"1-2 times per week\") %>% factor(order = FALSE) %>% relevel(ref = \"Zero\")\n\nimp_bns_combined_long$ff_cat2 <- case_when(imp_bns_combined_long$ff_cat == \"1-2 times per week\" ~ \"1-2 times per week\", imp_bns_combined_long$ff_cat == \"3-4 times per week\" ~ \"3-4 times per week\") %>% factor(order = FALSE)\n\nimp_bns_combined_long$ff_cat3 <- case_when(imp_bns_combined_long$ff_cat == \"3-4 times per week\" ~ \"3-4 times per week\",\n                                  imp_bns_combined_long$ff_cat == \"5 or more times per week\" ~ \"5 or more times per week\") %>% factor(order = FALSE)\n\n\n\n# Change numeric variables to increments\n\nimp_bns_combined_long$paid_work_hours_tens <- (imp_bns_combined_long$paid_work_hours)/10\nimp_bns_combined_long$unpaid_work_hours_tens <- (imp_bns_combined_long$unpaid_work_hours)/10\nimp_bns_combined_long$caregiving_hours_tens <- (imp_bns_combined_long$caregiving_hours)/10\nimp_bns_combined_long$units_four <- (imp_bns_combined_long$units)/4\nimp_bns_combined_long$age_five <- (imp_bns_combined_long$age)/5\n\n# Change Reference\nimp_bns_combined_long$food_insecure_2item <- factor(imp_bns_combined_long$food_insecure_2item, order = FALSE) %>% relevel(imp_bns_combined_long$food_insecure_2item, ref = \"No\")\n\n\n\nimp_bns_combined_long$total_work_hours <-   imp_bns_combined_long$paid_work_hours +\n                                            imp_bns_combined_long$unpaid_work_hours\n\n\n\nimp_bns_combined_long$ff_numeric <- recode(imp_bns_combined_long$ff_cat, \n                                             \"Zero\" = 0, \"1-2 times per week\" = 1,\n                                             \"3-4 times per week\" = 3,\n                                             \"5 or more times per week\" = 5)\n\n\nimp_bns_combined_long$ssb_numeric <- recode(imp_bns_combined_long$ssb_cat,\n                                              \"Zero\" = 0, \"1-8 ounces\" = 1,\n                                              \"9-16 ounces\" = 9, \"17 or more ounces\" = 17)\n\nimp_bns_combined_long$q77_numeric <- recode(imp_bns_combined_long$fruits3, \"0\" = 0,\n                                              \"1-2\" = 1, \"3 or more\" = 3)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Convert back to Mids\n\n#  imp_bns_combined_clean_mids <- as.mids(imp_bns_combined_long, .imp = \".imp\")\n\n# saveRDS(imp_bns_combined_clean_mids, file = \"imp_bns_combined_clean_mids.RData\")\n\nimp_bns_combined_clean_mids <- readRDS(\"clean_data/imp_bns_combined_clean_mids.RData\")\n```\n:::\n\n\n# Compare SSB Complete Case and Imputed Models\n\n\n::: {.cell}\n\n```{.r .cell-code}\noriginal_ssb_model <- with(bns_combined, MASS::polr(ssb_cat~calfresh3 + Cohort + gender + race_eth + age + monthly_hh_income + academic_level + physical_activity + storage_access + food_insecure_2item + homelessness_year + firstgen, Hess=TRUE))\n\n\n\nimp_ssb_model <- with(imp_bns_combined_clean_mids, MASS::polr(ssb_cat~calfresh3 + Cohort + gender + race_eth + age + monthly_hh_income + academic_level + physical_activity + storage_access + food_insecure_2item + homelessness_year + firstgen, Hess=TRUE))\n# pool(imp_ssb_model) |> summary()\n\noriginal_ssb_model_tidy <- tidy(original_ssb_model) %>%\n  mutate(model = \"original_ssb_model\")\n\nimp_ssb_model_tidy <- pool(imp_ssb_model) |> summary() %>%\n  mutate(model = \"imp_ssb_model\") %>% select(-df)\n\nssb_models <- bind_rows(original_ssb_model_tidy , imp_ssb_model_tidy)\n\ndwplot(ssb_models)  + geom_vline(xintercept = 0,\n               colour = \"black\",\n               linetype = 1)\n```\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# dwplot(imp_ssb_model_tidy) + geom_vline(xintercept = 1,\n#                colour = \"black\",\n#                linetype = 1)\n```\n:::\n\n\n# Compare Fast Food Complete Case and Imputed Models\n\n\n::: {.cell}\n\n```{.r .cell-code}\noriginal_ff_model <- MASS::polr(ff_cat~calfresh3 + Cohort + gender + race_eth + age + monthly_hh_income + academic_level + physical_activity + storage_access + kitchen_access + health_conscious + living_with_family + cooking_confident + food_insecure_2item + homelessness_year, data = bns_combined, Hess=TRUE)\n\n\nimp_ff_model <- with(imp_bns_combined_clean_mids, MASS::polr(ff_cat~calfresh3 + Cohort + gender + race_eth + age + monthly_hh_income + academic_level + physical_activity + storage_access + kitchen_access + health_conscious + living_with_family + cooking_confident + food_insecure_2item + homelessness_year, Hess=TRUE))\n# pool(imp_ff_model) |> summary()\n\n\noriginal_ff_model_tidy <- tidy(original_ff_model) %>%\n  mutate(model = \"original_ff_model\")\n\nimp_ff_model_tidy <- pool(imp_ff_model) |> summary() %>%\n  mutate(model = \"imp_ff_model\") %>% select(-df)\n\nff_models <- bind_rows(original_ff_model_tidy , imp_ff_model_tidy)\n\ndwplot(ff_models)  + geom_vline(xintercept = 0,\n               colour = \"black\",\n               linetype = 1)\n```\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n# Compare F&V Complete Case and Imputed Models\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimp_FV_model <- with(imp_bns_combined_clean_mids, MASS::polr(fruits3~calfresh3 + Cohort + gender + race_eth + age + monthly_hh_income + health_conscious + cooking_confident + physical_activity + food_insecure_2item, Hess=TRUE))\n\n\noriginal_FV_model <- MASS::polr(fruits3~calfresh3 + Cohort + gender + race_eth + age + monthly_hh_income + health_conscious + cooking_confident + physical_activity + food_insecure_2item, data = bns_combined, Hess=TRUE)\n\noriginal_FV_model_tidy <- tidy(original_FV_model) %>%\n  mutate(model = \"original_FV_model\")\n\nimp_FV_model_tidy <- pool(imp_FV_model) |> summary() %>%\n  mutate(model = \"imp_FV_model\") %>% select(-df)\n\nFV_models <- bind_rows(original_FV_model_tidy , imp_FV_model_tidy)\n\ndwplot(FV_models)  + geom_vline(xintercept = 0,\n               colour = \"black\",\n               linetype = 1)\n```\n\n::: {.cell-output-display}\n![](Imputations_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n:::\n",
    "supporting": [
      "Imputations_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}